local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/Tenelbacon/tenels-gui/main/orion')))()
local Window = OrionLib:MakeWindow({
    Name = "Tenels Script [PUBLIC]",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "BigHub"
})

local PlayerTab = Window:MakeTab({
    Name = "Player",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local walkSpeedValue = 16
local jumpHeightValue = 50

local function updateWalkSpeed(value)
    walkSpeedValue = value
    local character = game.Players.LocalPlayer.Character
    if character then
        character.Humanoid.WalkSpeed = value
    end
end

local function updateJumpHeight(value)
    jumpHeightValue = value
    local character = game.Players.LocalPlayer.Character
    if character then
        character.Humanoid.JumpPower = value
    end
end

local function keepWalkSpeedConstant()
    while true do
        local character = game.Players.LocalPlayer.Character
        if character then
            character.Humanoid.WalkSpeed = walkSpeedValue
        end
        wait(0.1) -- Adjust the frequency as needed
    end
end

local function keepJumpHeightConstant()
    while true do
        local character = game.Players.LocalPlayer.Character
        if character then
            character.Humanoid.JumpPower = jumpHeightValue
        end
        wait(0.1) -- Adjust the frequency as needed
    end
end

PlayerTab:AddSlider({
    Name = "WalkSpeed",
    Min = 1,
    Max = 100,
    Default = 16,
    Color = Color3.fromRGB(255, 255, 255),
    Increment = 1,
    ValueName = "Speed",
    Callback = function(Value)
        updateWalkSpeed(Value)
    end
})

PlayerTab:AddSlider({
    Name = "Jump Height",
    Min = 1,
    Max = 500,
    Default = 50,
    Color = Color3.fromRGB(255, 255, 255),
    Increment = 1,
    ValueName = "Height",
    Callback = function(Value)
        updateJumpHeight(Value)
    end
})

-- Start the loops to keep the values constant
spawn(keepWalkSpeedConstant)
spawn(keepJumpHeightConstant)

local isFlying = false
local isNoClip = false
local bodyVelocity
local bodyGyro
local flyLoop

local Noclip = nil
local Clip = nil

function noclip()
    Clip = false
    local function Nocl()
        if Clip == false and game.Players.LocalPlayer.Character then
            for _, v in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
                if v:IsA('BasePart') and v.CanCollide then
                    v.CanCollide = false
                end
            end
        end
        wait(0.21)
    end
    Noclip = game:GetService('RunService').Stepped:Connect(Nocl)
end

function clip()
    if Noclip then Noclip:Disconnect() end
    Clip = true
end

local function setNoClip(character, state)
    if state then
        noclip()
    else
        clip()
    end
end

local function startFlying(character, noClip)
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end
    
    humanoid.PlatformStand = true

    bodyVelocity = Instance.new("BodyVelocity", character.PrimaryPart)
    bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)

    bodyGyro = Instance.new("BodyGyro", character.PrimaryPart)
    bodyGyro.MaxTorque = Vector3.new(4000, 4000, 4000)
    bodyGyro.P = 3000

    local inputService = game:GetService("UserInputService")

    setNoClip(character, noClip)

    flyLoop = RunService.Heartbeat:Connect(function()
        if not isFlying then
            stopFlying()
            return
        end

        local camera = workspace.CurrentCamera
        local moveDirection = Vector3.new()

        if inputService:IsKeyDown(Enum.KeyCode.W) then
            moveDirection = moveDirection + camera.CFrame.LookVector
        end
        if inputService:IsKeyDown(Enum.KeyCode.S) then
            moveDirection = moveDirection - camera.CFrame.LookVector
        end
        if inputService:IsKeyDown(Enum.KeyCode.A) then
            moveDirection = moveDirection - camera.CFrame.RightVector
        end
        if inputService:IsKeyDown(Enum.KeyCode.D) then
            moveDirection = moveDirection + camera.CFrame.RightVector
        end
        if inputService:IsKeyDown(Enum.KeyCode.Space) then
            moveDirection = moveDirection + Vector3.new(0, 1, 0)
        end
        if inputService:IsKeyDown(Enum.KeyCode.LeftShift) then
            moveDirection = moveDirection + Vector3.new(0, -1, 0)
        end

        bodyVelocity.Velocity = moveDirection * 50
        bodyGyro.CFrame = CFrame.new(character.PrimaryPart.Position, character.PrimaryPart.Position + camera.CFrame.LookVector)
    end)
end

local function stopFlying()
    isFlying = false
    isNoClip = false
    local character = game.Players.LocalPlayer.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.PlatformStand = false
        end
    end
    if Noclip then
        Noclip:Disconnect()
        Noclip = nil
    end
    if bodyVelocity then
        bodyVelocity:Destroy()
        bodyVelocity = nil
    end
    if bodyGyro then
        bodyGyro:Destroy()
        bodyGyro = nil
    end
    if flyLoop then
        flyLoop:Disconnect()
        flyLoop = nil
    end
end

local function toggleFlying(character, noClip)
    if isFlying then
        stopFlying()
    else
        isFlying = true
        isNoClip = noClip
        startFlying(character, noClip)
    end
end

PlayerTab:AddButton({
    Name = "Fly",
    Callback = function()
        local character = game.Players.LocalPlayer.Character
        if character then
            toggleFlying(character, false)
        end
    end
})

PlayerTab:AddButton({
    Name = "No Clip",
    Callback = function()
        local character = game.Players.LocalPlayer.Character
        if character then
            toggleFlying(character, true)
        end
    end
})

PlayerTab:AddButton({
    Name = "Rejoin",
    Callback = function()
        game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId, game.Players.LocalPlayer)
    end
})

OrionLib:Init()
